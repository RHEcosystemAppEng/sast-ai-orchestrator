# PostgreSQL setup
quarkus.datasource.db-kind=postgresql
quarkus.datasource.username=quarkus
quarkus.datasource.password=quarkus
quarkus.datasource.jdbc.url=jdbc:postgresql://localhost:5432/sast-ai

# Database schema management with Flyway
quarkus.hibernate-orm.database.generation=validate
quarkus.flyway.migrate-at-start=true
quarkus.flyway.repair-at-start=true
quarkus.flyway.baseline-on-migrate=true
quarkus.flyway.baseline-version=0

# Optional: show SQL queries
quarkus.hibernate-orm.log.sql=false

# Write dates as ISO-8601 strings with timezone instead of timestamps (set it to false to use ISO-8601 strings)
quarkus.jackson.write-dates-as-timestamps=false
quarkus.jackson.timezone=UTC

# Application version (filtered from Maven at build time)
quarkus.application.version=${project.version}

# sast.ai.workflow.namespace=${SAST_AI_WORKFLOW_NAMESPACE:jude-test}
# sast.ai.workflow.known.false.positive.base.repo=${KNOWN_FALSE_POSITIVE_BASE_REPO:https://please-provide-known-false-positives-repo-link}
sast.ai.workflow.namespace=${SAST_AI_WORKFLOW_NAMESPACE:sast-ai}
quarkus.log.category."org.jboss.logging".level=DEBUG
quarkus.kubernetes-client.trust-certs=false

# OpenShift Console URL configuration
openshift.console.base.url=${OPENSHIFT_CONSOLE_BASE_URL:https://console-openshift-console.apps.appeng.clusters.se-apps.redhat.com}

# Google Service Account configuration
google.service.account.secret.path=${GOOGLE_SERVICE_ACCOUNT_SECRET_PATH:/etc/secrets/google-service-account-secret/service_account.json}

# GCS configuration
gcs.bucket.name=${GCS_BUCKET_NAME:}

# S3/MinIO configuration (using same credentials as DVC)
s3.endpoint.url=${AWS_S3_ENDPOINT_URL:}
s3.access.key=${AWS_ACCESS_KEY_ID:}
s3.secret.key=${AWS_SECRET_ACCESS_KEY:}
s3.bucket.name=${S3_OUTPUT_BUCKET_NAME:tekton-results}

# PVC storage configuration
sast.ai.workspace.shared.size=20Gi
sast.ai.workspace.cache.size=10Gi

# Cleanup configuration
sast.ai.cleanup.completed.pipelineruns=false

# URL validation HTTP client timeout configuration
# NOTE: This service uses a separate HTTP client from other components in the application
url-validation.connection-timeout=5s
url-validation.request-timeout=30s

# Job batch sequential execution configuration
sast.ai.batch.job.polling.interval=5000
sast.ai.batch.job.timeout=3600000

# MLOps batch parallel execution configuration
mlops.batch.max.parallel.jobs=3

# Recovery Configuration
# Recovery runs ONLY on startup using leader election
# Jobs/batches not updated in this many minutes are potentially orphaned
recovery.orphaned.job.threshold.minutes=5
# Maximum number of orphaned jobs to recover per startup cycle
recovery.max.jobs.per.cycle=100

# DVC API Server configuration
# The DVC API server URL
quarkus.rest-client.dvc-api.url=${DVC_API_URL:http://sast-ai-dvc:8000}

# OSH (Open Scan Hub) Integration Configuration
# Master toggle for OSH integration
# Note: Originally changed to 'true' in S3 integration PR, but reverted to maintain
# backward compatibility and avoid enabling OSH polling by default across all environments.
# Use environment variable OSH_INTEGRATION_ENABLED=true to enable in specific deployments.
osh.integration.enabled=${OSH_INTEGRATION_ENABLED:false}

# OSH API connection settings
osh.api.base-url=${OSH_API_BASE_URL:https://cov01.lab.eng.brq2.redhat.com}

# Package filtering - comma-separated list of packages to monitor
# Example: systemd,kernel,glibc
osh.packages=${OSH_PACKAGES:adcli,audit,cpio,glibc,graphite2,gzip,libconfig,libksba,libpcap,libpng,libtalloc,libuser,lua,mpdecimal,nano,ncurses,popt,rpcbind,samba,sqlite,sysfsutils,systemd,texinfo,tpm2-tools,trace-cmd,unzip,util-linux}

# Polling behavior configuration
osh.batch.size=${OSH_BATCH_SIZE:10}
osh.poll.interval=${OSH_POLL_INTERVAL:30s}
osh.scan.start-id=${OSH_SCAN_START_ID:1000000}
osh.scan.max-per-cycle=${OSH_SCAN_MAX_PER_CYCLE:50}

# JSON download configuration for OSH logs
osh.json.download-timeout=${OSH_JSON_DOWNLOAD_TIMEOUT:30s}
osh.json.primary-file=${OSH_JSON_PRIMARY_FILE:scan-results-imp.json}

# Quarkus REST Client configuration for OSH API
quarkus.rest-client.osh-api.url=${osh.api.base-url}
quarkus.rest-client.osh-api.connect-timeout=10000
quarkus.rest-client.osh-api.read-timeout=30000
quarkus.rest-client.osh-api.follow-redirects=true

# TLS configuration for OSH API (Quarkus 3.x TLS registry)
quarkus.tls.osh-api.trust-all=true
quarkus.tls.osh-api.hostname-verification-algorithm=NONE
quarkus.rest-client.osh-api.tls-configuration-name=osh-api

# OSH Retry Configuration
# Master toggle for retry mechanism
osh.retry.enabled=${OSH_RETRY_ENABLED:false}

# Retry behavior configuration
osh.retry.max-attempts=${OSH_RETRY_MAX_ATTEMPTS:3}
osh.retry.batch-size=${OSH_RETRY_BATCH_SIZE:5}
osh.retry.backoff-minutes=${OSH_RETRY_BACKOFF_MINUTES:20}
osh.retry.exponential-backoff=${OSH_RETRY_EXPONENTIAL_BACKOFF:true}

# Retention and cleanup configuration
osh.retry.retention-days=${OSH_RETRY_RETENTION_DAYS:7}
osh.retry.cleanup-interval=${OSH_RETRY_CLEANUP_INTERVAL:24h}

# CORS Configuration for frontend dev
quarkus.http.cors.enabled=true
quarkus.http.cors.origins=*
quarkus.http.cors.methods=GET,POST,PUT,DELETE,OPTIONS
quarkus.http.cors.headers=accept,authorization,content-type,x-requested-with
quarkus.http.cors.exposed-headers=
quarkus.http.cors.access-control-max-age=24H
quarkus.http.cors.access-control-allow-credentials=true

# Swagger UI / OpenAPI Configuration
# Enable Swagger UI in production builds (disabled by default, enabled in dev mode)
quarkus.swagger-ui.always-include=${ENABLE_SWAGGER_UI:false}
# Optional: Enable OpenAPI endpoint
quarkus.smallrye-openapi.enable=true
quarkus.smallrye-openapi.info-title=SAST AI Orchestrator API
quarkus.smallrye-openapi.info-version=${quarkus.application.version}
quarkus.smallrye-openapi.info-description=API for SAST AI Orchestrator
quarkus.smallrye-openapi.info-contact-name=SAST AI Team
